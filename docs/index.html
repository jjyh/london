<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>londontime</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="site_libs/datatables-binding-0.32/datatables.js"></script>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="site_libs/dt-core-bootstrap-1.13.6/css/dataTables.bootstrap.min.css" rel="stylesheet">

<link href="site_libs/dt-core-bootstrap-1.13.6/css/dataTables.bootstrap.extra.css" rel="stylesheet">

<script src="site_libs/dt-core-bootstrap-1.13.6/js/jquery.dataTables.min.js"></script>

<script src="site_libs/dt-core-bootstrap-1.13.6/js/dataTables.bootstrap.min.js"></script>

<script src="site_libs/jszip-1.13.6/jszip.min.js"></script>

<link href="site_libs/dt-ext-buttons-bootstrap-1.13.6/css/buttons.bootstrap.min.css" rel="stylesheet">

<script src="site_libs/dt-ext-buttons-bootstrap-1.13.6/js/dataTables.buttons.min.js"></script>

<script src="site_libs/dt-ext-buttons-bootstrap-1.13.6/js/buttons.html5.min.js"></script>

<script src="site_libs/dt-ext-buttons-bootstrap-1.13.6/js/buttons.colVis.min.js"></script>

<script src="site_libs/dt-ext-buttons-bootstrap-1.13.6/js/buttons.print.min.js"></script>

<script src="site_libs/dt-ext-buttons-bootstrap-1.13.6/js/buttons.bootstrap.min.js"></script>

<link href="site_libs/dt-ext-fixedcolumns-bootstrap-1.13.6/css/fixedColumns.bootstrap.min.css" rel="stylesheet">

<script src="site_libs/dt-ext-fixedcolumns-bootstrap-1.13.6/js/dataTables.fixedColumns.min.js"></script>

<script src="site_libs/dt-ext-fixedcolumns-bootstrap-1.13.6/js/fixedColumns.bootstrap.min.js"></script>

<link href="site_libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">

<script src="site_libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>

<link href="site_libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">

<script src="site_libs/selectize-0.12.0/selectize.min.js"></script>

<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<link href="site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">

<script src="site_libs/leaflet-1.3.1/leaflet.js"></script>

<link href="site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">

<script src="site_libs/proj4-2.6.2/proj4.min.js"></script>

<script src="site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>

<link href="site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">

<script src="site_libs/leaflet-binding-2.2.1/leaflet.js"></script>

<script src="site_libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>

<script src="site_libs/leaflet-providers-plugin-2.2.1/leaflet-providers-plugin.js"></script>



<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">londontime</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#table" id="toc-table" class="nav-link active" data-scroll-target="#table">Table</a>
  <ul class="collapse">
  <li><a href="#map" id="toc-map" class="nav-link" data-scroll-target="#map">Map</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">londontime</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>References:</p>
<p>Dashboards: Using R to create actionable science - 2&nbsp; Dynamic: Quarto docs (tbep-tech.github.io)</p>
<p>Geocoding via Python - <a href="https://stackoverflow.com/questions/69854674/python-generate-lat-long-points-from-address">pandas - Python generate lat/long points from address - Stack Overflow</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(crosstalk)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'leaflet' was built under R version 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'reticulate' was built under R version 4.3.3</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.chart-wrapper</span> {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">overflow-x</span><span class="ch">:</span> <span class="dv">scroll</span><span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<style type="text/css">
.chart-wrapper {
  overflow-x: scroll;
}
</style>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## import location data</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>dt_loc <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">'data/locations.xlsx'</span>, <span class="at">col_names =</span> <span class="cn">TRUE</span>, <span class="at">trim_ws=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span>  <span class="fu">drop_na</span>(Address)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>dt_loc<span class="sc">$</span>Address <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dt_loc<span class="sc">$</span>Address, <span class="st">", London, England"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#The crosstalk package can incorporate additional dynamic functionality in a Quarto document. As the name implies, it allows linking between plots and tables by including embedded Javascript in the rendered HTML file. This allows functionality that looks interactive as in a Shiny application, but does not require Shiny Server.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="table" class="level1">
<h1>Table</h1>
<p>to do - pivot days to facilitate map layer subset?<br>
lock down header row</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>dt_loc<span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">filter =</span> <span class="st">"top"</span>,  <span class="co"># allows filtering on each column</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">extensions =</span> <span class="fu">c</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Buttons"</span>,  <span class="co"># add download buttons, etc</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">'FixedColumns'</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>      <span class="co">#"Scroller"  # for scrolling down the rows rather than pagination</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">rownames =</span> <span class="cn">FALSE</span>,  <span class="co"># remove rownames</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"bootstrap"</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">class =</span> <span class="st">"compact"</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="st">"100%"</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">dom =</span> <span class="st">"Blrtip"</span>,  <span class="co"># specify content (search box, etc)</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">deferRender =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">scrollY =</span> <span class="dv">500</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">fixedColumns =</span> <span class="fu">list</span>(<span class="at">leftColumns =</span> <span class="dv">1</span>), <span class="co">#lock column</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">fixedHeader =</span> <span class="cn">TRUE</span>, <span class="co">#lock header</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">scroller =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">buttons =</span> <span class="fu">list</span>(</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">I</span>(<span class="st">"colvis"</span>),  <span class="co"># turn columns on and off</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"csv"</span>,  <span class="co"># download as .csv</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"excel"</span>  <span class="co"># download as .xlsx</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-18f259b4e7f8c7e295a6" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-18f259b4e7f8c7e295a6">{"x":{"style":"bootstrap","filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"3\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","extensions":["Buttons","FixedColumns"],"data":[["William Morris Gallery","British library","Imperial War Museum","V&amp;A","Sambourne house (morris wallpaper)","London library (tiny books)","Middle Temple (uni architecture)","The British Museum","The Wallace Collection","National Theatre Bookshop","Daunt Books","The Wolsely","Blackfriars","Fortnum &amp; Mason","Sketch London","Harrods","The Royal Institution","Mercato","Fischers","The Conran Shop","Bake","Seven Dials Market","Leadenhall Market","The Old Bank of England","Pick and Cheese","Cakes and Bubbles","Tower Bridge","Liberty London","Noble rot","North Sea Fish","Savoir Faire","The Fryer's Delight","St Martin-in-the-Fields","Penhaligon","M&amp;S","Selfridges","The Design Museum","Postal museum","Natural history museum","Sweetings","Pieminister","The Seafood Bar","The sea the sea","Arments Pie &amp; Mash","M.Manze pies","LSE Passfield Hall","Virginia House","Crystal Maze","Fogg House of Botanicals","Fogg Society of Exploration","Fogg Residence","Waitrose Bloomsbury","Arsenal Emirates Stadium","Mousetrap"],["Sight","Sight","Sight","Sight, Food","Sight","Sight","Sight, Food","Sight","Sight","Shop","Shop","Food","Food","Shop","Food","Shop","Sight","Food","Food","Shop","Food","Food","Sight","Food","Food","Food","Sight","Sight","Food","Food","Food","Food","Activity","Shop","Shop","Shop","Shop, sight","Sight",null,"Food","Food","Food","Food","Food","Food","Base","Base","Activity","Food","Food","Food","Shop","Activity","Activity"],["www.wmgallery.org.uk","reading rooms (reader's ticket is required for the latter) | Tip A 10-minute walk south is the University of London's School of Oriental and African Studies, in which can be found the Brunei Gallery. Opened in 1996, it offers a changing programme of historical exhibitions from the Middle East, Asia and Africa","www.iwm.org.uk  |","Henry Cole Wing (now part of the V&amp;A), www.vam.ac.uk  North of the V&amp;CA is the Royal Geographical Society in Lowther Lodge, designed by Norman Shaw. This learned society was founded in 1830, and is open to non-members for occasional exhibitions and lectures (www.rgs.org.","www.rbkc.gov.uk  Tip Around the corner at 12 Holland Park Road is the much grander house of the painter Frederick (Lord) Leighton, a member of the Holland Park Circle.\r\nHis work and the tiled walls make for a memorable visit (www.rbkc.gov.uk/museums).","ww.londonlibrary.co.uk\r\n fee of 20 allows daily membership to view anywhere; informal short fours are also available","www.middletemple.org.uk ; for tours email events@middletemple.org.uk/ Tip The long-closed Aldwych Underground station is minutes away on The Strand.\r\nOfficial tours of this and other disused tube stations are available (www.ltmuseum.co.uk).",null,"Hertford House, Manchester Square This small museum is located in the heart of Marylebone and has a wonderful collection of art and antiques, as well as a lovely cafe.","Outside, the South Bank hosts a huge array of second-hand booksellers, but if you find yourself looking for plays o a uniquely curated bookstore, pop into the National Theatre and brows their wonderful collection.",null,"Stop in at any time of the day for excellent food in this beautiful art deco restaurant.","Deservedly protected by landmark status, this 1904 Art Nouveau masterpiece (also spelled the Black Friar) is as jolly as the fat friars that bedeck it in bronze, wood, and glass. A short walk from St Paul's, it was once snuggled down a few dark alleys, but neighboring demolitions liberated it; now it's blessed with a noisy outdoor patio and walls of windows bathed in afternoon sunshine from over the Thames. The back saloon was designed for the upper classes, hence its exceptionally overbaked interior in marble and bronze; the undulating front bar, where pop music plays and pub crawls frequently pass through, is extraordinarily well-stocked with a range of cask ales and cider. Pricey food is shuttled from the upstairs kitchen via a hand-cranked dumbwaiter.  www.nicholsonspubs.co.uk","A London icon since 1707 offering up afternoon tea, ice cream at the parlour and a grocery store full of the finest foods.","One of the most memorable places to enjoy afternoon tea in London.",null,"Home to the Faraday Museum, the Royal Institute also organises workshops and lectures for children and adults.","This Grade I-listed church has been repurposed into a stunning food hall","If you are looking to eat schnitzels and sausages with the ambiance of 1920s Vienna, this is the place for you.","The Conran Shop is probably my favourite shop in London, up there with Liberty of London. They have the coolest home accessories and furniture, and walking through the store is simply a pleasure.","HK bakery. A Japanese taiyaki cone with your choice of matcha, vanilla or a twist, because you have always wanted to eat ice cream out of a fish.","Go for Pick and Cheese,","Open daily Go for the history and stunning architecture, stay for the chocolate brioche from Aux Merveilleux de Fred.","A stunning pub with dramatic interiors, and their garden has its own double decker bus.","A cheese conveyor belt restaurant in Covent Garden Market. Pick your fancy.","Unique artisan desserts in the heart of Piccadilly.",null,"tudor style exterior department store","East of the British Museum and 2 blocks from the Charles Dickens Museum, behind an old storefront amid the transporting upscale boutiques of Lamb's Conduit Street, spend a languid meal samping.  Mansion House spectacularly well-chosen wines, cheeses, and sublimely fine slices of Spanie hams. There are also a few changing British-drawn dishes like gnocchi with wild garlic, baked Scottish cod, and Middlewhite pork chops. a second location in Soho at 2 Greek St.  noon-2 30pm Set mens is for 2 courses and 22 for 3 courses.  www.noblerot.co.uk","www.northseafishrestaurant.co.uk.courses Â£14-Â£29.  ** SEAFOOD Don't expect a linoleum-lined chippy, but a classy fish market-cum-restaurant, hidden on a lost-in-time side street, Every hotel manager within a walkable radius has recommended it pretty much since it opened in 1977. Portions are huge, and there's always a selec. tion of fresh fish (sole, salmon, halibut, and so on). If you need a healthier option, you can also get your fish grilled. Try the terrific homemade tartar sauce, or, for fans of little fishies, sample grilled sardines with salad. Here, take-away is about half the price of sitting down.","www.savoir.co.uk Main courses Â£5-Â£20; 2-course set menu Â£24 Â£27 *** FRENCH After braving the rummage sale of mediocre gastronomic clip joints around the British Museum, patrons are known to smugly proclaim this their \"discovery\"-omitting the reality that it's been presenting what it correctly terms \"affordable gourmet\" since 1995. How could anyone have ignored this bistro-style traveler's gift, where nothing is processed and everything is made-to-order? Meals are more than reliable; in this area, they're miracles on plates. The menu might include ample portions of nimbly executed dishes like pan-roasted duck magret, bouillabaisse, tequila-lime chicken, or beef bourguignon","Main courses Â£4-Â£7.  ** TRADITIONAL BRITISH/TAKE-AWAY In our age, no one would dare name their joint something as hydrogenated as The Fryer's Delight. Fortunately, this joint is not of this age. It's a true old-world chippy, where the fry fat is from beef drippings, chips come in paper wrappings, the wooden booths and checkered floor date to the lean postwar years, and the men behind the counter are almost callously gruff. Prices are anachronistic, too: Nothing's more expensive than â‚¬6.20, and most are under Â£5. Order yours with mushy peas. It's a 10-minute walk east of the British Museum; look for the logo of a codfish tipping his bowler hat (seriously).","Right in the thick of Trafalgar Square","41 Wellington or 16 Burlington arcade.  Green fern",null,null,"www.designmuseum.org. permanent collection free, exhibitions charge Â£10-Â£18.  Relocated to a caverous landmark modemist building in Kensington in 2016, the Design Museum is where you'll find the cool kids of current style and architecture waxing esoteric about their thought processes in themed exhibitions. The top-floor balcony celebrates everyday objects (typefaces, laptops) that have been designed well.","www.postalmuseum.org. Full admission Â£17 adults, Â£12 ages 16-24, Â£10 ages 3-15; Â£1 discount if purchased online. Audio guide Â£3 on your own smartphone.","www.nhm.acuk. Free admission but Â£5 sug-Tusted donation, timed reservations suggested but not required.","Fish pie","take away pies Borough Market, alternately can buy at Waitrose","same lunch &amp; dinner menu",null,"stewed eel, pies","stewed eel, pies",null,null,"April 17. 19:00","Brunch","Train/steampunk themed, nibbles","the original, Nibbles only","inside Brunswick Centre","not avail. On match days (13,16,17,21)","3pm"],["Lloyd Park, Forest Road, E17 4PP, London, England","96 Euston Road, NW1 2DB, London, England","Lambeth Rd.  SE1 6HZ, London, England","Cromwell Rd,  SW7 2RL, London, England","18 Stafford Terrace, W8 7BH, London, England","14 St. James's Square, London, England","Middle Temple Lane, EC4Y 9AT, London, England","Great Russell St, WC1B 3DG, London, England","20 Manchester Square, London, England","National Theatre, SE1 9PX, London, England","84 Marylebone High St, W1U 4QW, London, England","160 Piccadilly, St James's, W1J 9EB, London, England","114 Queen Victoria St., London, England","181 Piccadilly, St James's, W1A 1ER, London, England","9 Conduit St, W1S 2XG, London, England","87-135 Brompton Rd, SW1X 7XL, London, England","21 Albemarle St, London, England","St. Mark's Church, North Audley St, W1K 6ZA, London, England","50 Marylebone High St, London, England","55 Marylebone High St, W1U 5HS, London, England","9 Wardour St, London, England","41 Earlham St, London, England","Gracechurch St, London, England","194 Fleet St., London, England","17 Short's Gardens, London, England","70 Regent St, London, England","Tower Bridge Rd, London, England","222 Regent St, London, England","51 Lambs Conduit St, London, England","7 Leigh St, London, England","42 New Oxford St, London, England","19 Theobald's Rd, London, England","Trafalgar Square, London, England","41 Wellington, London, England","458 Oxford St., London, England","400 Oxford st., London, England","224-238 Kensington High St., London, England","15-20 Phoenix Place, London, England","Cromwell Rd., London, England","39 Queen Victoria St., London, England","8 Southwark St, London, England","77 Dean St., London, England","174 Pavilion Rd., London, England","7 Westmoreland Rd., London, England","87 Tower Bridge Rd., London, England","1 Endsleigh Place, London, England","31 Bloomsbury Way, London, England","22 Shaftesbury Ave, London, England","48 Newman St, London, England","1A Bedford St, London, England","15 Bruton Lane, London, England","Unit 57 Bernard St, London, England","75 Drayton Park, London, England","5 West St, London, England"],["Walthamstow Central (Victoria line)","King's Cross (Victoria, Northern, Hammersmith &amp;City and Circle lines)","Lambeth North (Bakerloo line)","South Kensington (Piccadilly, District, and Circle lines)","Kensington High Street (District and Circle lines)","Green Park (Jubilee, Piccadilly and Victoria lines) or Picadilly Circus (Bakerloo and Piccadily lines)","Chancery Lane (Central line) or Temple (District and Circle lines)",null,null,null,null,null,"Blackfriars",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"King's Cross St Pancras or Russell Square.","Holborn or Tottenham Court Road","Holborn or Chancery Lane.",null,"Covent harden or green park",null,null,"High Street Kensington.","Farringdon or Chancery Lane.","South Kensington.",null,null,null,null,null,null,"Russell Square",null,null,null,null,null,null,"Arsenal","Leicester Sqaure / Charing Cross"],[1,1,1,1,2,2,null,1,1,1,1,2,1,1,2,3,2,2,1,1,1,2,1,2,1,2,1,1,3,2,3,null,2,2,3,2,1,3,2,null,2,null,null,null,null,null,null,1,2,2,2,null,1,1],["x","9:30 a.m.-8 p.m.","10am-6pm","10am-5.45pm","x","9.30am - 9pm",null,"10 a.m.-5 p.m.","10am-5pm","10-10:30","9 a.m.-7:30 p.m",null,"10am-11pm","45585","8 a.m.-12 a.m.","10 a.m.-9 p.m","9a.m.-5p.m.",null,"7:30 a.m.-9:30 p.m","45583","45636",null,null,"11:30 a.m.-10 p.m.","12-9:30 p.m.","45617",null,"10 a.m.-8 p.m.","noon-2 30pm","5-9pm","noon-10pm","11:30am-10pm",null,"45584","45544","45575","10am-6pm","x","10am-5.50pm","11:30-15:00","x","12-10pm","x","x","10:30-18:00",null,null,null,null,null,null,"8am-10pm","930-1700",null],["10am -5pm;","9:30 a.m.-8 p.m.","10am-6pm","10am-5.45pm","x","9.30am - 9pm",null,"10 a.m.-5 p.m.","10am-5pm","10-10:30","9 a.m.-7:30 p.m",null,"10am-11pm","45585","8 a.m.-12 a.m.","10 a.m.-9 p.m","9a.m.-5p.m.",null,"7:30 a.m.-10 p.m","45583","45636",null,null,"11:30 a.m.-10 p.m.","12-9:30 p.m.","45617",null,"10 a.m.-8 p.m.","noon-2 30pm","noon-2:30pm and 5-9:30pm","noon-10pm","11:30am-10pm",null,"45584","45544","45575","10am-6pm","x","10am-5.50pm","11:30-15:00","9am-5pm","12-10pm","45641","10:30-16:00","10:30-18:00",null,null,null,null,null,null,"8am-10pm","930-1700",null],["10am -5pm;","9:30 a.m.-8 p.m.","10am-6pm","10am-5.45pm","10am-5.30pm","9.30am - 5.30pm",null,"10 a.m.-5 p.m.","10am-5pm","10-10:30","9 a.m.-7:30 p.m",null,"10am-11pm","45585","8 a.m.-12 a.m.","10 a.m.-9 p.m","9a.m.-5p.m.",null,"7:30 a.m.-10 p.m","45583","45636",null,null,"11:30 a.m.-10 p.m.","12-9:30 p.m.","45617",null,"10 a.m.-8 p.m.","noon-2 30pm","noon-2:30pm and 5-9:30pm","noon-10pm","11:30am-10pm",null,"45584","45544","45575","10am-6pm","10am-5pm","10am-5.50pm","11:30-15:00","9am-5pm","12-10pm","45641","10:30-16:00","10:30-18:00",null,null,null,"4pm-12am","4pm-12am","5pm-2am","8am-10pm","930-1700",null],["10am -5pm;","9:30 a.m.-8 p.m.","10am-6pm","10am-5.45pm","10am-5.30pm","9.30am - 5.30pm",null,"10 a.m.-5 p.m.","10am-5pm","10-10:30","9 a.m.-7:30 p.m",null,"10am-11pm","45585","8 a.m.-12 a.m.","10 a.m.-9 p.m","9a.m.-5p.m.",null,"7:30 a.m.-10 p.m","45583","45636",null,null,"11:30 a.m.-11 p.m.","12-9:30 p.m.","45617",null,"10 a.m.-8 p.m.","noon-2 30pm","noon-2:30pm and 5-9:30pm","noon-10pm","11:30am-10pm",null,"45584","45544","45575","10am-6pm","10am-5pm","10am-5.50pm","11:30-15:00","9am-5pm","12-10pm","45641","10:30-16:00","10:30-18:00",null,null,null,"4pm-12am","4pm-12am","4pm-12am","8am-10pm","930-1700",null],["10am -5pm;","Friday, 9:30a.m.-6p.m.","10am-6pm","10am- 10pm","10am-5.30pm","9.30am - 5.30pm",null,"10 a.m.-8:30 p.m.","10am-5pm","10-10:30","9 a.m.-7:30 p.m",null,"10am-11pm","45585","8 a.m.-12 a.m.","10 a.m.-9 p.m","9a.m.-5p.m.",null,"7:30 a.m.-10 p.m","45583","45636",null,null,"11:30 a.m.-11 p.m.","12-9:30 p.m.","45617",null,"10 a.m.-8 p.m.","noon-2 30pm","noon-2:30pm and 5-9:30pm","noon-11pm","11:30am-10pm",null,"45584","45544","45575","10am-9pm.","10am-5pm","10am-5.50pm","11:30-15:00","9am-5pm","12-10pm","45641","10:30-16:00","10:30-19:00",null,null,null,"3pm-1am","4pm-12am","4pm-12am","8am-10pm","930-1700",null],["10am -5pm;","9:30a.m.-5p.m.","10am-6pm","10 a.m.-5:45 p.m.","10am-5.30pm","9.30am - 5.30pm",null,"10 a.m.-5 p.m.","10am-5pm","10-10:30","9 a.m.-7:30 p.m",null,"9am-11pm","45585","8 a.m.-12 a.m.","10 a.m.-9 p.m","x",null,"9 a.m.-9:30 p.m","45583","45636",null,null,"11:30 a.m.-10 p.m.","11 a.m.-9:30 p.m.","45617",null,"10 a.m.-8 p.m.",null,"noon-2:30pm and 5-9:30pm","noon-11pm","11:30am-10pm",null,"45584","45544","45574","10am-9pm.","10am-5pm","10am-5.50pm","x","10am-5pm","12-10pm","45641","10:30-17:00","10:30-20:00",null,null,null,"12pm-1am","1pm-12am","2pm-12am","8am-10pm","930-1700",null],["10am -5pm;","11 a.m.-5 p.m.","10am-6pm","10 a.m.-5:45 p.m.","10am-5.30pm",null,null,"10 a.m.-5 p.m.","10am-5pm","x","11 a.m.-6 p.m.",null,"noon-10:30pm","45644","8 a.m.-12 a.m.","11:30 a.m.-6 p.m.","x",null,"9 a.m.-9:30 p.m","45644","45635",null,null,"11:30 a.m.-8 p.m.","11 a.m.-7:30 p.m.","45617",null,"12-6 p.m.",null,"x","noon-10pm","x",null,"45644","45644","1130-1800","10am-6pm","10am-5pm","10am-5.50pm","x","10am-5pm","12-10pm","12-15:30","x","45611",null,null,null,null,null,null,"12-6pm","1000-1600",null],[null,null,null,"Friday",null,"Monday, Tuesday",null,"Friday",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"Monday",null,null,null,null,null,null,"Friday, Saturday",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"table table-condensed\">\n  <thead>\n    <tr>\n      <th>Place<\/th>\n      <th>Category<\/th>\n      <th>Details<\/th>\n      <th>Address<\/th>\n      <th>NearestStn<\/th>\n      <th>Priority<\/th>\n      <th>Monday<\/th>\n      <th>Tuesday<\/th>\n      <th>Wednesday<\/th>\n      <th>Thursday<\/th>\n      <th>Friday<\/th>\n      <th>Saturday<\/th>\n      <th>Sunday<\/th>\n      <th>Late<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"Blrtip","deferRender":true,"pageLength":10,"scrollY":500,"fixedColumns":{"leftColumns":1},"fixedHeader":true,"scroller":true,"buttons":[["colvis"],"csv","excel"],"columnDefs":[{"className":"dt-right","targets":5},{"name":"Place","targets":0},{"name":"Category","targets":1},{"name":"Details","targets":2},{"name":"Address","targets":3},{"name":"NearestStn","targets":4},{"name":"Priority","targets":5},{"name":"Monday","targets":6},{"name":"Tuesday","targets":7},{"name":"Wednesday","targets":8},{"name":"Thursday","targets":9},{"name":"Friday","targets":10},{"name":"Saturday","targets":11},{"name":"Sunday","targets":12},{"name":"Late","targets":13}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Before using python</p>
<p>You have to discover the path to your the .exe python file and then specify it in the .Renviron file. - Sys.setenv(RETICULATE_PYTHON = “C:\ProgramData\Anaconda3”)</p>
<ul>
<li><pre><code>Sys.setenv(RETICULATE_PYTHON = "C:/Users/hoja/AppData/Local/anaconda3")</code></pre></li>
<li>library(reticulate)</li>
<li>repl_python()</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> geopy.geocoders <span class="im">import</span> Nominatim <span class="co">#had to pip install this first</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Using Nominatim with the default user_agent is strongly discouraged, as it violates Nominatim’s Usage Policy https://operations.osmfoundation.org/policies/nominatim/ and may possibly cause 403 and 429 HTTP errors. Please make sure to specify a custom user_agent with Nominatim(user_agent="my-application")</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>geolocator <span class="op">=</span> Nominatim(user_agent<span class="op">=</span><span class="st">"myApp"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>dt_loc_py <span class="op">=</span> r.dt_loc <span class="co">#import df from R to Py https://nrennie.rbind.io/blog/combining-r-and-python-with-reticulate-and-quarto/</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#claims to have no attribute latitude</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># dt_loc_py[['location_lat', 'location_long']] = dt_loc_py['Address'].apply(geolocator.geocode).apply(lambda x: pd.Series([x.latitude, x.longitude], index=['location_lat', 'location_long']))</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># dt_loc_py[['location']] = dt_loc_py['Address'].apply(geolocator.geocode) # this doesn't work unless all addresses can be found - number will mismatch</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">#this works</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co"># geolocator.geocode(dt_loc_py['Address'][1])</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># geolocator.geocode(dt_loc_py['Address'][1]).latitude</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>lat <span class="op">=</span> []</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>longi <span class="op">=</span> []</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>location <span class="op">=</span> []</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> places <span class="kw">in</span> dt_loc_py[<span class="st">'Address'</span>]:</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  location.append(geolocator.geocode(places, timeout<span class="op">=</span><span class="dv">100</span>))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  lat.append(location[<span class="bu">len</span>(location)<span class="op">-</span><span class="dv">1</span>].latitude)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  longi.append(location[<span class="bu">len</span>(location)<span class="op">-</span><span class="dv">1</span>].longitude)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">#match back to df</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>dt_loc_py[<span class="st">'lat'</span>] <span class="op">=</span> lat</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>dt_loc_py[<span class="st">'longi'</span>] <span class="op">=</span> longi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="map" class="level2">
<h2 class="anchored" data-anchor-id="map">Map</h2>
<p>Current legend: colour by category, dark inner dot = open late Todo<br>
1. add open-by-day layer control<br>
2. add hours by pop up<br>
3. Crosstalk with table<br>
4. layer tube station</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>dt_loc_py<span class="ot">&lt;-</span>py<span class="sc">$</span>dt_loc_py</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>dt_loc_py<span class="ot">&lt;-</span>dt_loc_py <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">lng =</span> longi)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a palette that maps factor levels to colors</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">colorFactor</span>(<span class="fu">c</span>(<span class="st">"pink"</span>, <span class="st">"turquoise"</span>, <span class="st">"purple"</span>,  <span class="st">"green"</span>,<span class="st">"yellow"</span>, <span class="st">"orange"</span>), <span class="at">domain =</span> <span class="fu">c</span>(<span class="st">"Food"</span>, <span class="st">"Sight"</span>,<span class="st">"Sight, Food"</span>, <span class="st">"Shop, sight"</span>,<span class="st">"Shop"</span>, <span class="st">"Activity"</span>))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>map<span class="ot">&lt;-</span>dt_loc_py <span class="sc">%&gt;%</span> </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  leaflet<span class="sc">::</span><span class="fu">leaflet</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  leaflet<span class="sc">::</span><span class="fu">addProviderTiles</span>(providers<span class="sc">$</span>OpenStreetMap)<span class="sc">%&gt;%</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircleMarkers</span>(<span class="at">lng =</span> <span class="sc">~</span>lng, <span class="at">lat =</span> <span class="sc">~</span>lat, </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">group =</span> <span class="st">"Saturday"</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">popup =</span> <span class="sc">~</span>Place,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">radius =</span> <span class="dv">9</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> <span class="sc">~</span><span class="fu">pal</span>(Category),</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">opacity =</span> <span class="fl">0.7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addLayersControl</span>(<span class="at">overlayGroups =</span> <span class="fu">c</span>(<span class="st">"Saturday"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in pal(Category): Some values were outside the color scale and will be
treated as NA

Warning in pal(Category): Some values were outside the color scale and will be
treated as NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>map <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircles</span>(<span class="at">data =</span> <span class="fu">subset</span>(dt_loc_py, <span class="sc">!</span><span class="fu">is.na</span>(Late)),</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">lng =</span> <span class="sc">~</span>lng, <span class="at">lat =</span> <span class="sc">~</span>lat,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">popup =</span> <span class="sc">~</span>Late, </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">radius =</span> <span class="dv">3</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">opacity =</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-f1376d2960e85386fb47" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-f1376d2960e85386fb47">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addCircleMarkers","args":[[51.5909751,51.5298647,51.4968895,51.4957618,51.50048485000001,51.5073196,51.5111426,51.5179111,51.517,51.5070387,51.52043705,51.50739265,51.5120907,51.5081856,51.5127342,51.4992104,51.5097487,51.513152,51.5216,51.5222599,51.5107952,51.5139847,51.5114899,51.5139117,51.5144162,51.5104207,51.5037593,51.51361945,51.5196246,51.5263636,51.51716585,51.5203668,51.508037,51.53684455,51.5141984,51.51459555,51.4999153,51.5247243,51.4122989,51.5124815,51.5060858,51.51402035,51.4934141,51.47714955,51.4963383,51.5253344,51.5172093,51.5697425,51.51887360000001,51.509812,51.5100617,51.5230017,51.55504035,51.5722668],[-0.0197994,-0.1272986,-0.1096916,-0.1739034,-0.1968744821615088,-0.1369285718534718,-0.1107168,-0.1271056,-0.153602,-0.1145301535158193,-0.1522504144370992,-0.1409072085942409,-0.0969782,-0.1381409128060151,-0.1414857,-0.162989315296602,-0.1423300590666685,-0.1528791103766605,-0.1516726,-0.1511049130674916,-0.1317928,-0.1252031,-0.0854043,-0.1114683671824827,-0.1257538,-0.1382079,-0.0764919,-0.1407505087261227,-0.1182714,-0.1253140372789675,-0.1257752839642942,-0.1173231,-0.1280494107072472,0.1673545304461281,-0.1542276,-0.1528293603670513,-0.2001565715795336,-0.1139982,-0.2986783,-0.0927123,-0.0907587,-0.1330096718832435,-0.1589329132801039,-0.2412879,-0.082749,-0.1302216,-0.1251464,-0.3486738,-0.1366277110281161,-0.1236075,-0.1439255,-0.125319,-0.1083996708672374,-0.3383031],9,null,"Saturday",{"interactive":true,"className":"","stroke":true,"color":["#FFFF00","#FFFF00","#FFFF00","#FFA500","#FFFF00","#FFFF00","#FFA500","#FFFF00","#FFFF00","#A020F0","#A020F0","#40E0D0","#40E0D0","#A020F0","#40E0D0","#A020F0","#FFFF00","#40E0D0","#40E0D0","#A020F0","#40E0D0","#40E0D0","#FFFF00","#40E0D0","#40E0D0","#40E0D0","#FFFF00","#FFFF00","#40E0D0","#40E0D0","#40E0D0","#40E0D0","#FFC0CB","#A020F0","#A020F0","#A020F0","#00FF00","#FFFF00","#808080","#40E0D0","#40E0D0","#40E0D0","#40E0D0","#40E0D0","#40E0D0","#808080","#808080","#FFC0CB","#40E0D0","#40E0D0","#40E0D0","#A020F0","#FFC0CB","#FFC0CB"],"weight":5,"opacity":0.7,"fill":true,"fillColor":["#FFFF00","#FFFF00","#FFFF00","#FFA500","#FFFF00","#FFFF00","#FFA500","#FFFF00","#FFFF00","#A020F0","#A020F0","#40E0D0","#40E0D0","#A020F0","#40E0D0","#A020F0","#FFFF00","#40E0D0","#40E0D0","#A020F0","#40E0D0","#40E0D0","#FFFF00","#40E0D0","#40E0D0","#40E0D0","#FFFF00","#FFFF00","#40E0D0","#40E0D0","#40E0D0","#40E0D0","#FFC0CB","#A020F0","#A020F0","#A020F0","#00FF00","#FFFF00","#808080","#40E0D0","#40E0D0","#40E0D0","#40E0D0","#40E0D0","#40E0D0","#808080","#808080","#FFC0CB","#40E0D0","#40E0D0","#40E0D0","#A020F0","#FFC0CB","#FFC0CB"],"fillOpacity":0.2},null,null,["William Morris Gallery","British library","Imperial War Museum","V&A","Sambourne house (morris wallpaper)","London library (tiny books)","Middle Temple (uni architecture)","The British Museum","The Wallace Collection","National Theatre Bookshop","Daunt Books","The Wolsely","Blackfriars","Fortnum & Mason","Sketch London","Harrods","The Royal Institution","Mercato","Fischers","The Conran Shop","Bake","Seven Dials Market","Leadenhall Market","The Old Bank of England","Pick and Cheese","Cakes and Bubbles","Tower Bridge","Liberty London","Noble rot","North Sea Fish","Savoir Faire","The Fryer's Delight","St Martin-in-the-Fields","Penhaligon","M&S","Selfridges","The Design Museum","Postal museum","Natural history museum","Sweetings","Pieminister","The Seafood Bar","The sea the sea","Arments Pie & Mash","M.Manze pies","LSE Passfield Hall","Virginia House","Crystal Maze","Fogg House of Botanicals","Fogg Society of Exploration","Fogg Residence","Waitrose Bloomsbury","Arsenal Emirates Stadium","Mousetrap"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[[],"Saturday",{"collapsed":true,"autoZIndex":true,"position":"topright"}]},{"method":"addCircles","args":[[51.4957618,51.5073196,51.5179111,51.5263636,51.4999153],[-0.1739034,-0.1369285718534718,-0.1271056,-0.1253140372789675,-0.2001565715795336],3,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.9,"fill":true,"fillColor":"#03F","fillOpacity":0.2},["Friday","Monday, Tuesday","Friday","Monday","Friday, Saturday"],null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null,null]}],"limits":{"lat":[51.4122989,51.5909751],"lng":[-0.3486738,0.1673545304461281]}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#https://rpubs.com/mattdray/basic-leaflet-maps</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># leaflet::addLayersControl(</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   overlayGroups = c("Outstanding", "Good", "Other"),  # add these layers</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   options = layersControlOptions(collapsed = FALSE)  # expand on hover?</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ) %&gt;% </span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hideGroup(c("Good", "Other"))  # turn these off by default</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  </span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#leaflet::addAwesomeMarkers</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create shared data</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> SharedData<span class="sc">$</span><span class="fu">new</span>(tbwqdat)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create a filter input</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">filter_slider</span>(<span class="st">"chla"</span>, <span class="st">"Chlorophyll-a"</span>, sd, <span class="at">column=</span><span class="sc">~</span>chla, <span class="at">step=</span><span class="fl">0.1</span>, <span class="at">width=</span><span class="dv">250</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># use shared data with crosstalk widgets</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">bscols</span>(</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">leaflet</span>(sd) <span class="sc">%&gt;%</span> </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addTiles</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addMarkers</span>(),</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">datatable</span>(</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    sd, <span class="at">extensions =</span> <span class="st">"Scroller"</span>, <span class="at">style=</span><span class="st">"bootstrap"</span>, <span class="at">class =</span> <span class="st">"compact"</span>, <span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">rownames =</span> F,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">options =</span><span class="fu">list</span>(</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">scrollY =</span> <span class="dv">300</span>, <span class="at">scroller =</span> <span class="cn">TRUE</span>, </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">columnDefs =</span> <span class="fu">list</span>(</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list</span>(<span class="at">visible =</span> F, <span class="at">targets =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="dv">4</span>)),</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>         <span class="fu">list</span>(<span class="at">className =</span> <span class="st">'dt-left'</span>, <span class="at">targets =</span> <span class="st">'_all'</span>))</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">colnames =</span> <span class="fu">c</span>(<span class="st">'lat'</span>, <span class="st">'lon'</span>, <span class="st">'Bay segment'</span>, <span class="st">'Station'</span>, <span class="st">'mo'</span>, <span class="st">'Chl-a (ug/L)'</span>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>